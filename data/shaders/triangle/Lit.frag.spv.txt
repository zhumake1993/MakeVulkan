Lit.frag
// Module Version 10000
// Generated by (magic number): 80008
// Id's are bound by 526

                              Capability Shader
               2:             ExtInstImport  "GLSL.std.450"
                              MemoryModel Logical GLSL450
                              EntryPoint Fragment 5  "main" 204 217 248 524
                              ExecutionMode 5 OriginUpperLeft
               1:             String  "Lit.frag"
                              Source GLSL 450 1  "// OpModuleProcessed client vulkan100
// OpModuleProcessed target-env vulkan1.0
// OpModuleProcessed entry-point main
#line 1
#version 450

/////////////////////////////////////////////////////
// Light
/////////////////////////////////////////////////////

#define MaxLights 16
//layout (constant_id = 0) const int NUM_DIR_LIGHTS = 0;
//layout (constant_id = 1) const int NUM_POINT_LIGHTS = 0;
//layout (constant_id = 2) const int NUM_SPOT_LIGHTS = 0;
#define NUM_DIR_LIGHTS 1
#define NUM_POINT_LIGHTS 1
#define NUM_SPOT_LIGHTS 0

struct Light
{
	vec3 strength; // light color
	float falloffStart; // point/spot light only
	vec3 direction;// directional/spot lightonly
	float falloffEnd; // point/spot light only
	vec3 position; // point/spot light only
	float spotPower; // spot light only
};

struct Material
{
	vec4 diffuseAlbedo;
	vec3 fresnelR0;
	float roughness;
	mat4 matTransform;
};

float CalcAttenuation(float d, float falloffStart, float falloffEnd)
{
	// Linear falloff.
	return clamp((falloffEnd - d) / (falloffEnd - falloffStart), 0.0f, 1.0f);
}

// Schlick gives an approximation to Fresne reflectance
// (see pg. 233 “Real-Time Rendering 3rd Ed.”).
// R0 = ( (n-1)/(n+1) )^2, where n is the index of refraction.
vec3 SchlickFresnel(vec3 R0, vec3 normal, vec3 lightVec)
{
	float cosIncidentAngle = clamp(dot(normal, lightVec), 0.0f, 1.0f);
	float f0 = 1.0f - cosIncidentAngle;
	vec3 reflectPercent = R0 + (1.0f - R0)* (f0*f0*f0*f0*f0);
	return reflectPercent;
}

vec3 BlinnPhong(vec3 lightStrength, vec3 lightVec, vec3 normal, vec3 toEye, Material mat)
{
	// Derive m from the shininess, which is derived from the roughness.
	const float shininess = 1.0f - mat.roughness;
	const float m = shininess * 256.0f;
	vec3 halfVec = normalize(toEye + lightVec);
	
	float roughnessFactor = (m + 8.0f)*pow(max(dot(halfVec, normal), 0.0f), m) / 8.0f;
	vec3 fresnelFactor = SchlickFresnel(mat.fresnelR0, halfVec, lightVec);
	
	vec3 specAlbedo = fresnelFactor*roughnessFactor;
	
	// Our spec formula goes outside [0,1] range, but we are doing
	// LDR rendering. So scale it down a bit.
	specAlbedo = specAlbedo / (specAlbedo + 1.0f);
	return (mat.diffuseAlbedo.rgb + specAlbedo) * lightStrength;
}

vec3 ComputeDirectionalLight(Light L, Material mat, vec3 normal, vec3 toEye)
{
	// The light vector aims opposite the direction the light rays travel.
	vec3 lightVec = -L.direction;
	
	// Scale light down by Lambert’s cosine law.
	float ndotl = max(dot(lightVec, normal), 0.0f);
	vec3 lightStrength = L.strength * ndotl;
	return BlinnPhong(lightStrength, lightVec, normal, toEye, mat);
}

vec3 ComputePointLight(Light L, Material mat, vec3 pos, vec3 normal, vec3 toEye)
{
	// The vector from the surface to the light.
	vec3 lightVec = L.position - pos;
	
	// The distance from surface to light.
	float d = length(lightVec);
	
	// Range test.
	if(d > L.falloffEnd)
	return vec3(0.0f, 0.0f, 0.0f);
	
	// Normalize the light vector.
	lightVec /= d;
	
	// Scale light down by Lambert’s cosine law.
	float ndotl = max(dot(lightVec, normal), 0.0f);
	vec3 lightStrength = L.strength * ndotl;
	
	// Attenuate light by distance.
	float att = CalcAttenuation(d, L.falloffStart, L.falloffEnd);
	lightStrength *= att;
	
	return BlinnPhong(lightStrength, lightVec, normal, toEye, mat);
}

vec3 ComputeSpotLight(Light L, Material mat, vec3 pos, vec3 normal, vec3 toEye)
{
	// The vector from the surface to the light.
	vec3 lightVec = L.position - pos;
	
	// The distance from surface to light.
	float d = length(lightVec);
	
	// Range test.
	if(d > L.falloffEnd)
	return vec3(0.0f, 0.0f, 0.0f);
	
	// Normalize the light vector.
	lightVec /= d;
	
	// Scale light down by Lambert’s cosine law.
	float ndotl = max(dot(lightVec, normal), 0.0f);
	vec3 lightStrength = L.strength * ndotl;
	
	// Attenuate light by distance.
	float att = CalcAttenuation(d, L.falloffStart, L.falloffEnd);
	lightStrength *= att;
	
	// Scale by spotlight
	float spotFactor = pow(max(dot(-lightVec, L.direction), 0.0f), L.spotPower);
	lightStrength *= spotFactor;
	
	return BlinnPhong(lightStrength, lightVec, normal, toEye, mat);
}

vec4 ComputeLighting(Light gLights[MaxLights], Material mat, vec3 pos, vec3 normal, vec3 toEye, vec3 shadowFactor)
{
	vec3 result = vec3(0.0f, 0.0f, 0.0f);
	int i = 0;

	//#if (NUM_DIR_LIGHTS > 0)
		for(i = 0; i < NUM_DIR_LIGHTS; ++i)
		{
			result += shadowFactor[i] * ComputeDirectionalLight(gLights[i], mat, normal, toEye);
		}
	//#endif
	
	//#if (NUM_POINT_LIGHTS > 0)
		//for(i = NUM_DIR_LIGHTS; i < NUM_DIR_LIGHTS+NUM_POINT_LIGHTS; ++i)
		{
			//result += ComputePointLight(gLights[i], mat, pos, normal, toEye);
		}
	//#endif
	
	//#if (NUM_SPOT_LIGHTS > 0)
		//for(i = NUM_DIR_LIGHTS + NUM_POINT_LIGHTS; i < NUM_DIR_LIGHTS + NUM_POINT_LIGHTS + NUM_SPOT_LIGHTS; ++i)
		{
			//result += ComputeSpotLight(gLights[i], mat, pos, normal, toEye);
		}
	//#endif

	return vec4(result, 0.0f);
}

/////////////////////////////////////////////////////
// Uniform
/////////////////////////////////////////////////////

layout(set=1, binding=0) uniform PerView {
    mat4 view;
    mat4 proj;
	vec4 eyePos;
	
	vec4 ambientLight;
	// Indices [0, NUM_DIR_LIGHTS) are directional lights;
	// indices [NUM_DIR_LIGHTS, NUM_DIR_LIGHTS+NUM_POINT_LIGHTS) are
	// point lights;
	// indices [NUM_DIR_LIGHTS+NUM_POINT_LIGHTS,
	// NUM_DIR_LIGHTS+NUM_POINT_LIGHT+NUM_SPOT_LIGHTS)
	// are spot lights for a maximum of MaxLights per object.
	Light lights[MaxLights];
};

layout(set=2, binding=0) uniform PerMaterial{
	Material gMaterial;
};

layout(set=2, binding=1) uniform sampler2D baseTexture;

layout(location = 0) in vec3 v_Normal;
layout(location = 1) in vec2 v_Texcoord;
layout(location = 2) in vec4 v_wPos;

layout(location = 0) out vec4 o_Color;

/////////////////////////////////////////////////////
// Shader
/////////////////////////////////////////////////////

void main() {

	// Interpolating normal can unnormalize it, so renormalize it.
	vec3 normal = normalize(v_Normal);
	
	// Vector from point being lit to eye.
	vec4 toEyeW = normalize(eyePos - v_wPos);
	
	// Material
	Material mat = gMaterial;
	mat.diffuseAlbedo = mat.diffuseAlbedo * texture(baseTexture, v_Texcoord);
	
	// Indirect lighting.
	vec4 ambient = ambientLight * mat.diffuseAlbedo;
	
	// Direct lighting.
	vec3 shadowFactor = vec3(1.0f, 1.0f, 1.0f);
	vec4 directLight = ComputeLighting(lights, mat, v_wPos.xyz, normal, toEyeW.xyz, shadowFactor);
	vec4 litColor = ambient + directLight;
	
	// Common convention to take alpha from diffuse material.
	litColor.a = mat.diffuseAlbedo.a;

	o_Color = litColor;
}"
                              Name 5  "main"
                              Name 14  "SchlickFresnel(vf3;vf3;vf3;"
                              Name 11  "R0"
                              Name 12  "normal"
                              Name 13  "lightVec"
                              Name 18  "Material"
                              MemberName 18(Material) 0  "diffuseAlbedo"
                              MemberName 18(Material) 1  "fresnelR0"
                              MemberName 18(Material) 2  "roughness"
                              MemberName 18(Material) 3  "matTransform"
                              Name 26  "BlinnPhong(vf3;vf3;vf3;vf3;struct-Material-vf4-vf3-f1-mf441;"
                              Name 21  "lightStrength"
                              Name 22  "lightVec"
                              Name 23  "normal"
                              Name 24  "toEye"
                              Name 25  "mat"
                              Name 28  "Light"
                              MemberName 28(Light) 0  "strength"
                              MemberName 28(Light) 1  "falloffStart"
                              MemberName 28(Light) 2  "direction"
                              MemberName 28(Light) 3  "falloffEnd"
                              MemberName 28(Light) 4  "position"
                              MemberName 28(Light) 5  "spotPower"
                              Name 35  "ComputeDirectionalLight(struct-Light-vf3-f1-vf3-f1-vf3-f11;struct-Material-vf4-vf3-f1-mf441;vf3;vf3;"
                              Name 31  "L"
                              Name 32  "mat"
                              Name 33  "normal"
                              Name 34  "toEye"
                              Name 48  "ComputeLighting(struct-Light-vf3-f1-vf3-f1-vf3-f11[16];struct-Material-vf4-vf3-f1-mf441;vf3;vf3;vf3;vf3;"
                              Name 42  "gLights"
                              Name 43  "mat"
                              Name 44  "pos"
                              Name 45  "normal"
                              Name 46  "toEye"
                              Name 47  "shadowFactor"
                              Name 51  "cosIncidentAngle"
                              Name 58  "f0"
                              Name 61  "reflectPercent"
                              Name 80  "shininess"
                              Name 86  "m"
                              Name 90  "halfVec"
                              Name 95  "roughnessFactor"
                              Name 107  "fresnelFactor"
                              Name 109  "param"
                              Name 112  "param"
                              Name 114  "param"
                              Name 117  "specAlbedo"
                              Name 137  "lightVec"
                              Name 141  "ndotl"
                              Name 146  "lightStrength"
                              Name 151  "param"
                              Name 153  "param"
                              Name 155  "param"
                              Name 157  "param"
                              Name 159  "param"
                              Name 164  "result"
                              Name 167  "i"
                              Name 180  "param"
                              Name 183  "param"
                              Name 185  "param"
                              Name 187  "param"
                              Name 202  "normal"
                              Name 204  "v_Normal"
                              Name 207  "toEyeW"
                              Name 208  "Light"
                              MemberName 208(Light) 0  "strength"
                              MemberName 208(Light) 1  "falloffStart"
                              MemberName 208(Light) 2  "direction"
                              MemberName 208(Light) 3  "falloffEnd"
                              MemberName 208(Light) 4  "position"
                              MemberName 208(Light) 5  "spotPower"
                              Name 210  "PerView"
                              MemberName 210(PerView) 0  "view"
                              MemberName 210(PerView) 1  "proj"
                              MemberName 210(PerView) 2  "eyePos"
                              MemberName 210(PerView) 3  "ambientLight"
                              MemberName 210(PerView) 4  "lights"
                              Name 212  ""
                              Name 217  "v_wPos"
                              Name 221  "mat"
                              Name 222  "Material"
                              MemberName 222(Material) 0  "diffuseAlbedo"
                              MemberName 222(Material) 1  "fresnelR0"
                              MemberName 222(Material) 2  "roughness"
                              MemberName 222(Material) 3  "matTransform"
                              Name 223  "PerMaterial"
                              MemberName 223(PerMaterial) 0  "gMaterial"
                              Name 225  ""
                              Name 244  "baseTexture"
                              Name 248  "v_Texcoord"
                              Name 253  "ambient"
                              Name 259  "shadowFactor"
                              Name 261  "directLight"
                              Name 263  "param"
                              Name 502  "param"
                              Name 504  "param"
                              Name 507  "param"
                              Name 509  "param"
                              Name 512  "param"
                              Name 515  "litColor"
                              Name 524  "o_Color"
                              Decorate 204(v_Normal) Location 0
                              MemberDecorate 208(Light) 0 Offset 0
                              MemberDecorate 208(Light) 1 Offset 12
                              MemberDecorate 208(Light) 2 Offset 16
                              MemberDecorate 208(Light) 3 Offset 28
                              MemberDecorate 208(Light) 4 Offset 32
                              MemberDecorate 208(Light) 5 Offset 44
                              Decorate 209 ArrayStride 48
                              MemberDecorate 210(PerView) 0 ColMajor
                              MemberDecorate 210(PerView) 0 Offset 0
                              MemberDecorate 210(PerView) 0 MatrixStride 16
                              MemberDecorate 210(PerView) 1 ColMajor
                              MemberDecorate 210(PerView) 1 Offset 64
                              MemberDecorate 210(PerView) 1 MatrixStride 16
                              MemberDecorate 210(PerView) 2 Offset 128
                              MemberDecorate 210(PerView) 3 Offset 144
                              MemberDecorate 210(PerView) 4 Offset 160
                              Decorate 210(PerView) Block
                              Decorate 212 DescriptorSet 1
                              Decorate 212 Binding 0
                              Decorate 217(v_wPos) Location 2
                              MemberDecorate 222(Material) 0 Offset 0
                              MemberDecorate 222(Material) 1 Offset 16
                              MemberDecorate 222(Material) 2 Offset 28
                              MemberDecorate 222(Material) 3 ColMajor
                              MemberDecorate 222(Material) 3 Offset 32
                              MemberDecorate 222(Material) 3 MatrixStride 16
                              MemberDecorate 223(PerMaterial) 0 Offset 0
                              Decorate 223(PerMaterial) Block
                              Decorate 225 DescriptorSet 2
                              Decorate 225 Binding 0
                              Decorate 244(baseTexture) DescriptorSet 2
                              Decorate 244(baseTexture) Binding 1
                              Decorate 248(v_Texcoord) Location 1
                              Decorate 524(o_Color) Location 0
               3:             TypeVoid
               4:             TypeFunction 3
               7:             TypeFloat 32
               8:             TypeVector 7(float) 3
               9:             TypePointer Function 8(fvec3)
              10:             TypeFunction 8(fvec3) 9(ptr) 9(ptr) 9(ptr)
              16:             TypeVector 7(float) 4
              17:             TypeMatrix 16(fvec4) 4
    18(Material):             TypeStruct 16(fvec4) 8(fvec3) 7(float) 17
              19:             TypePointer Function 18(Material)
              20:             TypeFunction 8(fvec3) 9(ptr) 9(ptr) 9(ptr) 9(ptr) 19(ptr)
       28(Light):             TypeStruct 8(fvec3) 7(float) 8(fvec3) 7(float) 8(fvec3) 7(float)
              29:             TypePointer Function 28(Light)
              30:             TypeFunction 8(fvec3) 29(ptr) 19(ptr) 9(ptr) 9(ptr)
              37:             TypeInt 32 0
              38:     37(int) Constant 16
              39:             TypeArray 28(Light) 38
              40:             TypePointer Function 39
              41:             TypeFunction 16(fvec4) 40(ptr) 19(ptr) 9(ptr) 9(ptr) 9(ptr) 9(ptr)
              50:             TypePointer Function 7(float)
              55:    7(float) Constant 0
              56:    7(float) Constant 1065353216
              81:             TypeInt 32 1
              82:     81(int) Constant 2
              88:    7(float) Constant 1132462080
              97:    7(float) Constant 1090519040
             108:     81(int) Constant 1
             126:     81(int) Constant 0
             127:             TypePointer Function 16(fvec4)
             165:    8(fvec3) ConstantComposite 55 55 55
             166:             TypePointer Function 81(int)
             174:             TypeBool
             203:             TypePointer Input 8(fvec3)
   204(v_Normal):    203(ptr) Variable Input
      208(Light):             TypeStruct 8(fvec3) 7(float) 8(fvec3) 7(float) 8(fvec3) 7(float)
             209:             TypeArray 208(Light) 38
    210(PerView):             TypeStruct 17 17 16(fvec4) 16(fvec4) 209
             211:             TypePointer Uniform 210(PerView)
             212:    211(ptr) Variable Uniform
             213:             TypePointer Uniform 16(fvec4)
             216:             TypePointer Input 16(fvec4)
     217(v_wPos):    216(ptr) Variable Input
   222(Material):             TypeStruct 16(fvec4) 8(fvec3) 7(float) 17
223(PerMaterial):             TypeStruct 222(Material)
             224:             TypePointer Uniform 223(PerMaterial)
             225:    224(ptr) Variable Uniform
             226:             TypePointer Uniform 222(Material)
             236:     81(int) Constant 3
             237:             TypePointer Function 17
             241:             TypeImage 7(float) 2D sampled format:Unknown
             242:             TypeSampledImage 241
             243:             TypePointer UniformConstant 242
244(baseTexture):    243(ptr) Variable UniformConstant
             246:             TypeVector 7(float) 2
             247:             TypePointer Input 246(fvec2)
 248(v_Texcoord):    247(ptr) Variable Input
             260:    8(fvec3) ConstantComposite 56 56 56
             262:     81(int) Constant 4
             264:             TypePointer Uniform 209
             280:     81(int) Constant 5
             353:     81(int) Constant 6
             368:     81(int) Constant 7
             383:     81(int) Constant 8
             398:     81(int) Constant 9
             413:     81(int) Constant 10
             428:     81(int) Constant 11
             443:     81(int) Constant 12
             458:     81(int) Constant 13
             473:     81(int) Constant 14
             488:     81(int) Constant 15
             519:     37(int) Constant 3
             523:             TypePointer Output 16(fvec4)
    524(o_Color):    523(ptr) Variable Output
         5(main):           3 Function None 4
               6:             Label
     202(normal):      9(ptr) Variable Function
     207(toEyeW):    127(ptr) Variable Function
        221(mat):     19(ptr) Variable Function
    253(ambient):    127(ptr) Variable Function
259(shadowFactor):      9(ptr) Variable Function
261(directLight):    127(ptr) Variable Function
      263(param):     40(ptr) Variable Function
      502(param):     19(ptr) Variable Function
      504(param):      9(ptr) Variable Function
      507(param):      9(ptr) Variable Function
      509(param):      9(ptr) Variable Function
      512(param):      9(ptr) Variable Function
   515(litColor):    127(ptr) Variable Function
                              Line 1 202 0
             205:    8(fvec3) Load 204(v_Normal)
             206:    8(fvec3) ExtInst 2(GLSL.std.450) 69(Normalize) 205
                              Store 202(normal) 206
                              Line 1 205 0
             214:    213(ptr) AccessChain 212 82
             215:   16(fvec4) Load 214
             218:   16(fvec4) Load 217(v_wPos)
             219:   16(fvec4) FSub 215 218
             220:   16(fvec4) ExtInst 2(GLSL.std.450) 69(Normalize) 219
                              Store 207(toEyeW) 220
                              Line 1 208 0
             227:    226(ptr) AccessChain 225 126
             228:222(Material) Load 227
             229:   16(fvec4) CompositeExtract 228 0
             230:    127(ptr) AccessChain 221(mat) 126
                              Store 230 229
             231:    8(fvec3) CompositeExtract 228 1
             232:      9(ptr) AccessChain 221(mat) 108
                              Store 232 231
             233:    7(float) CompositeExtract 228 2
             234:     50(ptr) AccessChain 221(mat) 82
                              Store 234 233
             235:          17 CompositeExtract 228 3
             238:    237(ptr) AccessChain 221(mat) 236
                              Store 238 235
                              Line 1 209 0
             239:    127(ptr) AccessChain 221(mat) 126
             240:   16(fvec4) Load 239
             245:         242 Load 244(baseTexture)
             249:  246(fvec2) Load 248(v_Texcoord)
             250:   16(fvec4) ImageSampleImplicitLod 245 249
             251:   16(fvec4) FMul 240 250
             252:    127(ptr) AccessChain 221(mat) 126
                              Store 252 251
                              Line 1 212 0
             254:    213(ptr) AccessChain 212 236
             255:   16(fvec4) Load 254
             256:    127(ptr) AccessChain 221(mat) 126
             257:   16(fvec4) Load 256
             258:   16(fvec4) FMul 255 257
                              Store 253(ambient) 258
                              Line 1 215 0
                              Store 259(shadowFactor) 260
                              Line 1 216 0
             265:    264(ptr) AccessChain 212 262
             266:         209 Load 265
             267:  208(Light) CompositeExtract 266 0
             268:     29(ptr) AccessChain 263(param) 126
             269:    8(fvec3) CompositeExtract 267 0
             270:      9(ptr) AccessChain 268 126
                              Store 270 269
             271:    7(float) CompositeExtract 267 1
             272:     50(ptr) AccessChain 268 108
                              Store 272 271
             273:    8(fvec3) CompositeExtract 267 2
             274:      9(ptr) AccessChain 268 82
                              Store 274 273
             275:    7(float) CompositeExtract 267 3
             276:     50(ptr) AccessChain 268 236
                              Store 276 275
             277:    8(fvec3) CompositeExtract 267 4
             278:      9(ptr) AccessChain 268 262
                              Store 278 277
             279:    7(float) CompositeExtract 267 5
             281:     50(ptr) AccessChain 268 280
                              Store 281 279
             282:  208(Light) CompositeExtract 266 1
             283:     29(ptr) AccessChain 263(param) 108
             284:    8(fvec3) CompositeExtract 282 0
             285:      9(ptr) AccessChain 283 126
                              Store 285 284
             286:    7(float) CompositeExtract 282 1
             287:     50(ptr) AccessChain 283 108
                              Store 287 286
             288:    8(fvec3) CompositeExtract 282 2
             289:      9(ptr) AccessChain 283 82
                              Store 289 288
             290:    7(float) CompositeExtract 282 3
             291:     50(ptr) AccessChain 283 236
                              Store 291 290
             292:    8(fvec3) CompositeExtract 282 4
             293:      9(ptr) AccessChain 283 262
                              Store 293 292
             294:    7(float) CompositeExtract 282 5
             295:     50(ptr) AccessChain 283 280
                              Store 295 294
             296:  208(Light) CompositeExtract 266 2
             297:     29(ptr) AccessChain 263(param) 82
             298:    8(fvec3) CompositeExtract 296 0
             299:      9(ptr) AccessChain 297 126
                              Store 299 298
             300:    7(float) CompositeExtract 296 1
             301:     50(ptr) AccessChain 297 108
                              Store 301 300
             302:    8(fvec3) CompositeExtract 296 2
             303:      9(ptr) AccessChain 297 82
                              Store 303 302
             304:    7(float) CompositeExtract 296 3
             305:     50(ptr) AccessChain 297 236
                              Store 305 304
             306:    8(fvec3) CompositeExtract 296 4
             307:      9(ptr) AccessChain 297 262
                              Store 307 306
             308:    7(float) CompositeExtract 296 5
             309:     50(ptr) AccessChain 297 280
                              Store 309 308
             310:  208(Light) CompositeExtract 266 3
             311:     29(ptr) AccessChain 263(param) 236
             312:    8(fvec3) CompositeExtract 310 0
             313:      9(ptr) AccessChain 311 126
                              Store 313 312
             314:    7(float) CompositeExtract 310 1
             315:     50(ptr) AccessChain 311 108
                              Store 315 314
             316:    8(fvec3) CompositeExtract 310 2
             317:      9(ptr) AccessChain 311 82
                              Store 317 316
             318:    7(float) CompositeExtract 310 3
             319:     50(ptr) AccessChain 311 236
                              Store 319 318
             320:    8(fvec3) CompositeExtract 310 4
             321:      9(ptr) AccessChain 311 262
                              Store 321 320
             322:    7(float) CompositeExtract 310 5
             323:     50(ptr) AccessChain 311 280
                              Store 323 322
             324:  208(Light) CompositeExtract 266 4
             325:     29(ptr) AccessChain 263(param) 262
             326:    8(fvec3) CompositeExtract 324 0
             327:      9(ptr) AccessChain 325 126
                              Store 327 326
             328:    7(float) CompositeExtract 324 1
             329:     50(ptr) AccessChain 325 108
                              Store 329 328
             330:    8(fvec3) CompositeExtract 324 2
             331:      9(ptr) AccessChain 325 82
                              Store 331 330
             332:    7(float) CompositeExtract 324 3
             333:     50(ptr) AccessChain 325 236
                              Store 333 332
             334:    8(fvec3) CompositeExtract 324 4
             335:      9(ptr) AccessChain 325 262
                              Store 335 334
             336:    7(float) CompositeExtract 324 5
             337:     50(ptr) AccessChain 325 280
                              Store 337 336
             338:  208(Light) CompositeExtract 266 5
             339:     29(ptr) AccessChain 263(param) 280
             340:    8(fvec3) CompositeExtract 338 0
             341:      9(ptr) AccessChain 339 126
                              Store 341 340
             342:    7(float) CompositeExtract 338 1
             343:     50(ptr) AccessChain 339 108
                              Store 343 342
             344:    8(fvec3) CompositeExtract 338 2
             345:      9(ptr) AccessChain 339 82
                              Store 345 344
             346:    7(float) CompositeExtract 338 3
             347:     50(ptr) AccessChain 339 236
                              Store 347 346
             348:    8(fvec3) CompositeExtract 338 4
             349:      9(ptr) AccessChain 339 262
                              Store 349 348
             350:    7(float) CompositeExtract 338 5
             351:     50(ptr) AccessChain 339 280
                              Store 351 350
             352:  208(Light) CompositeExtract 266 6
             354:     29(ptr) AccessChain 263(param) 353
             355:    8(fvec3) CompositeExtract 352 0
             356:      9(ptr) AccessChain 354 126
                              Store 356 355
             357:    7(float) CompositeExtract 352 1
             358:     50(ptr) AccessChain 354 108
                              Store 358 357
             359:    8(fvec3) CompositeExtract 352 2
             360:      9(ptr) AccessChain 354 82
                              Store 360 359
             361:    7(float) CompositeExtract 352 3
             362:     50(ptr) AccessChain 354 236
                              Store 362 361
             363:    8(fvec3) CompositeExtract 352 4
             364:      9(ptr) AccessChain 354 262
                              Store 364 363
             365:    7(float) CompositeExtract 352 5
             366:     50(ptr) AccessChain 354 280
                              Store 366 365
             367:  208(Light) CompositeExtract 266 7
             369:     29(ptr) AccessChain 263(param) 368
             370:    8(fvec3) CompositeExtract 367 0
             371:      9(ptr) AccessChain 369 126
                              Store 371 370
             372:    7(float) CompositeExtract 367 1
             373:     50(ptr) AccessChain 369 108
                              Store 373 372
             374:    8(fvec3) CompositeExtract 367 2
             375:      9(ptr) AccessChain 369 82
                              Store 375 374
             376:    7(float) CompositeExtract 367 3
             377:     50(ptr) AccessChain 369 236
                              Store 377 376
             378:    8(fvec3) CompositeExtract 367 4
             379:      9(ptr) AccessChain 369 262
                              Store 379 378
             380:    7(float) CompositeExtract 367 5
             381:     50(ptr) AccessChain 369 280
                              Store 381 380
             382:  208(Light) CompositeExtract 266 8
             384:     29(ptr) AccessChain 263(param) 383
             385:    8(fvec3) CompositeExtract 382 0
             386:      9(ptr) AccessChain 384 126
                              Store 386 385
             387:    7(float) CompositeExtract 382 1
             388:     50(ptr) AccessChain 384 108
                              Store 388 387
             389:    8(fvec3) CompositeExtract 382 2
             390:      9(ptr) AccessChain 384 82
                              Store 390 389
             391:    7(float) CompositeExtract 382 3
             392:     50(ptr) AccessChain 384 236
                              Store 392 391
             393:    8(fvec3) CompositeExtract 382 4
             394:      9(ptr) AccessChain 384 262
                              Store 394 393
             395:    7(float) CompositeExtract 382 5
             396:     50(ptr) AccessChain 384 280
                              Store 396 395
             397:  208(Light) CompositeExtract 266 9
             399:     29(ptr) AccessChain 263(param) 398
             400:    8(fvec3) CompositeExtract 397 0
             401:      9(ptr) AccessChain 399 126
                              Store 401 400
             402:    7(float) CompositeExtract 397 1
             403:     50(ptr) AccessChain 399 108
                              Store 403 402
             404:    8(fvec3) CompositeExtract 397 2
             405:      9(ptr) AccessChain 399 82
                              Store 405 404
             406:    7(float) CompositeExtract 397 3
             407:     50(ptr) AccessChain 399 236
                              Store 407 406
             408:    8(fvec3) CompositeExtract 397 4
             409:      9(ptr) AccessChain 399 262
                              Store 409 408
             410:    7(float) CompositeExtract 397 5
             411:     50(ptr) AccessChain 399 280
                              Store 411 410
             412:  208(Light) CompositeExtract 266 10
             414:     29(ptr) AccessChain 263(param) 413
             415:    8(fvec3) CompositeExtract 412 0
             416:      9(ptr) AccessChain 414 126
                              Store 416 415
             417:    7(float) CompositeExtract 412 1
             418:     50(ptr) AccessChain 414 108
                              Store 418 417
             419:    8(fvec3) CompositeExtract 412 2
             420:      9(ptr) AccessChain 414 82
                              Store 420 419
             421:    7(float) CompositeExtract 412 3
             422:     50(ptr) AccessChain 414 236
                              Store 422 421
             423:    8(fvec3) CompositeExtract 412 4
             424:      9(ptr) AccessChain 414 262
                              Store 424 423
             425:    7(float) CompositeExtract 412 5
             426:     50(ptr) AccessChain 414 280
                              Store 426 425
             427:  208(Light) CompositeExtract 266 11
             429:     29(ptr) AccessChain 263(param) 428
             430:    8(fvec3) CompositeExtract 427 0
             431:      9(ptr) AccessChain 429 126
                              Store 431 430
             432:    7(float) CompositeExtract 427 1
             433:     50(ptr) AccessChain 429 108
                              Store 433 432
             434:    8(fvec3) CompositeExtract 427 2
             435:      9(ptr) AccessChain 429 82
                              Store 435 434
             436:    7(float) CompositeExtract 427 3
             437:     50(ptr) AccessChain 429 236
                              Store 437 436
             438:    8(fvec3) CompositeExtract 427 4
             439:      9(ptr) AccessChain 429 262
                              Store 439 438
             440:    7(float) CompositeExtract 427 5
             441:     50(ptr) AccessChain 429 280
                              Store 441 440
             442:  208(Light) CompositeExtract 266 12
             444:     29(ptr) AccessChain 263(param) 443
             445:    8(fvec3) CompositeExtract 442 0
             446:      9(ptr) AccessChain 444 126
                              Store 446 445
             447:    7(float) CompositeExtract 442 1
             448:     50(ptr) AccessChain 444 108
                              Store 448 447
             449:    8(fvec3) CompositeExtract 442 2
             450:      9(ptr) AccessChain 444 82
                              Store 450 449
             451:    7(float) CompositeExtract 442 3
             452:     50(ptr) AccessChain 444 236
                              Store 452 451
             453:    8(fvec3) CompositeExtract 442 4
             454:      9(ptr) AccessChain 444 262
                              Store 454 453
             455:    7(float) CompositeExtract 442 5
             456:     50(ptr) AccessChain 444 280
                              Store 456 455
             457:  208(Light) CompositeExtract 266 13
             459:     29(ptr) AccessChain 263(param) 458
             460:    8(fvec3) CompositeExtract 457 0
             461:      9(ptr) AccessChain 459 126
                              Store 461 460
             462:    7(float) CompositeExtract 457 1
             463:     50(ptr) AccessChain 459 108
                              Store 463 462
             464:    8(fvec3) CompositeExtract 457 2
             465:      9(ptr) AccessChain 459 82
                              Store 465 464
             466:    7(float) CompositeExtract 457 3
             467:     50(ptr) AccessChain 459 236
                              Store 467 466
             468:    8(fvec3) CompositeExtract 457 4
             469:      9(ptr) AccessChain 459 262
                              Store 469 468
             470:    7(float) CompositeExtract 457 5
             471:     50(ptr) AccessChain 459 280
                              Store 471 470
             472:  208(Light) CompositeExtract 266 14
             474:     29(ptr) AccessChain 263(param) 473
             475:    8(fvec3) CompositeExtract 472 0
             476:      9(ptr) AccessChain 474 126
                              Store 476 475
             477:    7(float) CompositeExtract 472 1
             478:     50(ptr) AccessChain 474 108
                              Store 478 477
             479:    8(fvec3) CompositeExtract 472 2
             480:      9(ptr) AccessChain 474 82
                              Store 480 479
             481:    7(float) CompositeExtract 472 3
             482:     50(ptr) AccessChain 474 236
                              Store 482 481
             483:    8(fvec3) CompositeExtract 472 4
             484:      9(ptr) AccessChain 474 262
                              Store 484 483
             485:    7(float) CompositeExtract 472 5
             486:     50(ptr) AccessChain 474 280
                              Store 486 485
             487:  208(Light) CompositeExtract 266 15
             489:     29(ptr) AccessChain 263(param) 488
             490:    8(fvec3) CompositeExtract 487 0
             491:      9(ptr) AccessChain 489 126
                              Store 491 490
             492:    7(float) CompositeExtract 487 1
             493:     50(ptr) AccessChain 489 108
                              Store 493 492
             494:    8(fvec3) CompositeExtract 487 2
             495:      9(ptr) AccessChain 489 82
                              Store 495 494
             496:    7(float) CompositeExtract 487 3
             497:     50(ptr) AccessChain 489 236
                              Store 497 496
             498:    8(fvec3) CompositeExtract 487 4
             499:      9(ptr) AccessChain 489 262
                              Store 499 498
             500:    7(float) CompositeExtract 487 5
             501:     50(ptr) AccessChain 489 280
                              Store 501 500
             503:18(Material) Load 221(mat)
                              Store 502(param) 503
             505:   16(fvec4) Load 217(v_wPos)
             506:    8(fvec3) VectorShuffle 505 505 0 1 2
                              Store 504(param) 506
             508:    8(fvec3) Load 202(normal)
                              Store 507(param) 508
             510:   16(fvec4) Load 207(toEyeW)
             511:    8(fvec3) VectorShuffle 510 510 0 1 2
                              Store 509(param) 511
             513:    8(fvec3) Load 259(shadowFactor)
                              Store 512(param) 513
             514:   16(fvec4) FunctionCall 48(ComputeLighting(struct-Light-vf3-f1-vf3-f1-vf3-f11[16];struct-Material-vf4-vf3-f1-mf441;vf3;vf3;vf3;vf3;) 263(param) 502(param) 504(param) 507(param) 509(param) 512(param)
                              Store 261(directLight) 514
                              Line 1 217 0
             516:   16(fvec4) Load 253(ambient)
             517:   16(fvec4) Load 261(directLight)
             518:   16(fvec4) FAdd 516 517
                              Store 515(litColor) 518
                              Line 1 220 0
             520:     50(ptr) AccessChain 221(mat) 126 519
             521:    7(float) Load 520
             522:     50(ptr) AccessChain 515(litColor) 519
                              Store 522 521
                              Line 1 222 0
             525:   16(fvec4) Load 515(litColor)
                              Store 524(o_Color) 525
                              Return
                              FunctionEnd
14(SchlickFresnel(vf3;vf3;vf3;):    8(fvec3) Function None 10
          11(R0):      9(ptr) FunctionParameter
      12(normal):      9(ptr) FunctionParameter
    13(lightVec):      9(ptr) FunctionParameter
              15:             Label
51(cosIncidentAngle):     50(ptr) Variable Function
          58(f0):     50(ptr) Variable Function
61(reflectPercent):      9(ptr) Variable Function
                              Line 1 44 0
              52:    8(fvec3) Load 12(normal)
              53:    8(fvec3) Load 13(lightVec)
              54:    7(float) Dot 52 53
              57:    7(float) ExtInst 2(GLSL.std.450) 43(FClamp) 54 55 56
                              Store 51(cosIncidentAngle) 57
                              Line 1 45 0
              59:    7(float) Load 51(cosIncidentAngle)
              60:    7(float) FSub 56 59
                              Store 58(f0) 60
                              Line 1 46 0
              62:    8(fvec3) Load 11(R0)
              63:    8(fvec3) Load 11(R0)
              64:    8(fvec3) CompositeConstruct 56 56 56
              65:    8(fvec3) FSub 64 63
              66:    7(float) Load 58(f0)
              67:    7(float) Load 58(f0)
              68:    7(float) FMul 66 67
              69:    7(float) Load 58(f0)
              70:    7(float) FMul 68 69
              71:    7(float) Load 58(f0)
              72:    7(float) FMul 70 71
              73:    7(float) Load 58(f0)
              74:    7(float) FMul 72 73
              75:    8(fvec3) VectorTimesScalar 65 74
              76:    8(fvec3) FAdd 62 75
                              Store 61(reflectPercent) 76
                              Line 1 47 0
              77:    8(fvec3) Load 61(reflectPercent)
                              ReturnValue 77
                              FunctionEnd
26(BlinnPhong(vf3;vf3;vf3;vf3;struct-Material-vf4-vf3-f1-mf441;):    8(fvec3) Function None 20
21(lightStrength):      9(ptr) FunctionParameter
    22(lightVec):      9(ptr) FunctionParameter
      23(normal):      9(ptr) FunctionParameter
       24(toEye):      9(ptr) FunctionParameter
         25(mat):     19(ptr) FunctionParameter
              27:             Label
   80(shininess):     50(ptr) Variable Function
           86(m):     50(ptr) Variable Function
     90(halfVec):      9(ptr) Variable Function
95(roughnessFactor):     50(ptr) Variable Function
107(fresnelFactor):      9(ptr) Variable Function
      109(param):      9(ptr) Variable Function
      112(param):      9(ptr) Variable Function
      114(param):      9(ptr) Variable Function
 117(specAlbedo):      9(ptr) Variable Function
                              Line 1 53 0
              83:     50(ptr) AccessChain 25(mat) 82
              84:    7(float) Load 83
              85:    7(float) FSub 56 84
                              Store 80(shininess) 85
                              Line 1 54 0
              87:    7(float) Load 80(shininess)
              89:    7(float) FMul 87 88
                              Store 86(m) 89
                              Line 1 55 0
              91:    8(fvec3) Load 24(toEye)
              92:    8(fvec3) Load 22(lightVec)
              93:    8(fvec3) FAdd 91 92
              94:    8(fvec3) ExtInst 2(GLSL.std.450) 69(Normalize) 93
                              Store 90(halfVec) 94
                              Line 1 57 0
              96:    7(float) Load 86(m)
              98:    7(float) FAdd 96 97
              99:    8(fvec3) Load 90(halfVec)
             100:    8(fvec3) Load 23(normal)
             101:    7(float) Dot 99 100
             102:    7(float) ExtInst 2(GLSL.std.450) 40(FMax) 101 55
             103:    7(float) Load 86(m)
             104:    7(float) ExtInst 2(GLSL.std.450) 26(Pow) 102 103
             105:    7(float) FMul 98 104
             106:    7(float) FDiv 105 97
                              Store 95(roughnessFactor) 106
                              Line 1 58 0
             110:      9(ptr) AccessChain 25(mat) 108
             111:    8(fvec3) Load 110
                              Store 109(param) 111
             113:    8(fvec3) Load 90(halfVec)
                              Store 112(param) 113
             115:    8(fvec3) Load 22(lightVec)
                              Store 114(param) 115
             116:    8(fvec3) FunctionCall 14(SchlickFresnel(vf3;vf3;vf3;) 109(param) 112(param) 114(param)
                              Store 107(fresnelFactor) 116
                              Line 1 60 0
             118:    8(fvec3) Load 107(fresnelFactor)
             119:    7(float) Load 95(roughnessFactor)
             120:    8(fvec3) VectorTimesScalar 118 119
                              Store 117(specAlbedo) 120
                              Line 1 64 0
             121:    8(fvec3) Load 117(specAlbedo)
             122:    8(fvec3) Load 117(specAlbedo)
             123:    8(fvec3) CompositeConstruct 56 56 56
             124:    8(fvec3) FAdd 122 123
             125:    8(fvec3) FDiv 121 124
                              Store 117(specAlbedo) 125
                              Line 1 65 0
             128:    127(ptr) AccessChain 25(mat) 126
             129:   16(fvec4) Load 128
             130:    8(fvec3) VectorShuffle 129 129 0 1 2
             131:    8(fvec3) Load 117(specAlbedo)
             132:    8(fvec3) FAdd 130 131
             133:    8(fvec3) Load 21(lightStrength)
             134:    8(fvec3) FMul 132 133
                              ReturnValue 134
                              FunctionEnd
35(ComputeDirectionalLight(struct-Light-vf3-f1-vf3-f1-vf3-f11;struct-Material-vf4-vf3-f1-mf441;vf3;vf3;):    8(fvec3) Function None 30
           31(L):     29(ptr) FunctionParameter
         32(mat):     19(ptr) FunctionParameter
      33(normal):      9(ptr) FunctionParameter
       34(toEye):      9(ptr) FunctionParameter
              36:             Label
   137(lightVec):      9(ptr) Variable Function
      141(ndotl):     50(ptr) Variable Function
146(lightStrength):      9(ptr) Variable Function
      151(param):      9(ptr) Variable Function
      153(param):      9(ptr) Variable Function
      155(param):      9(ptr) Variable Function
      157(param):      9(ptr) Variable Function
      159(param):     19(ptr) Variable Function
                              Line 1 71 0
             138:      9(ptr) AccessChain 31(L) 82
             139:    8(fvec3) Load 138
             140:    8(fvec3) FNegate 139
                              Store 137(lightVec) 140
                              Line 1 74 0
             142:    8(fvec3) Load 137(lightVec)
             143:    8(fvec3) Load 33(normal)
             144:    7(float) Dot 142 143
             145:    7(float) ExtInst 2(GLSL.std.450) 40(FMax) 144 55
                              Store 141(ndotl) 145
                              Line 1 75 0
             147:      9(ptr) AccessChain 31(L) 126
             148:    8(fvec3) Load 147
             149:    7(float) Load 141(ndotl)
             150:    8(fvec3) VectorTimesScalar 148 149
                              Store 146(lightStrength) 150
                              Line 1 76 0
             152:    8(fvec3) Load 146(lightStrength)
                              Store 151(param) 152
             154:    8(fvec3) Load 137(lightVec)
                              Store 153(param) 154
             156:    8(fvec3) Load 33(normal)
                              Store 155(param) 156
             158:    8(fvec3) Load 34(toEye)
                              Store 157(param) 158
             160:18(Material) Load 32(mat)
                              Store 159(param) 160
             161:    8(fvec3) FunctionCall 26(BlinnPhong(vf3;vf3;vf3;vf3;struct-Material-vf4-vf3-f1-mf441;) 151(param) 153(param) 155(param) 157(param) 159(param)
                              ReturnValue 161
                              FunctionEnd
48(ComputeLighting(struct-Light-vf3-f1-vf3-f1-vf3-f11[16];struct-Material-vf4-vf3-f1-mf441;vf3;vf3;vf3;vf3;):   16(fvec4) Function None 41
     42(gLights):     40(ptr) FunctionParameter
         43(mat):     19(ptr) FunctionParameter
         44(pos):      9(ptr) FunctionParameter
      45(normal):      9(ptr) FunctionParameter
       46(toEye):      9(ptr) FunctionParameter
47(shadowFactor):      9(ptr) FunctionParameter
              49:             Label
     164(result):      9(ptr) Variable Function
          167(i):    166(ptr) Variable Function
      180(param):     29(ptr) Variable Function
      183(param):     19(ptr) Variable Function
      185(param):      9(ptr) Variable Function
      187(param):      9(ptr) Variable Function
                              Line 1 137 0
                              Store 164(result) 165
                              Line 1 138 0
                              Store 167(i) 126
                              Line 1 141 0
                              Store 167(i) 126
                              Branch 168
             168:             Label
                              LoopMerge 170 171 None
                              Branch 172
             172:             Label
             173:     81(int) Load 167(i)
             175:   174(bool) SLessThan 173 108
                              BranchConditional 175 169 170
             169:               Label
                                Line 1 143 0
             176:     81(int)   Load 167(i)
             177:     50(ptr)   AccessChain 47(shadowFactor) 176
             178:    7(float)   Load 177
             179:     81(int)   Load 167(i)
             181:     29(ptr)   AccessChain 42(gLights) 179
             182:   28(Light)   Load 181
                                Store 180(param) 182
             184:18(Material)   Load 43(mat)
                                Store 183(param) 184
             186:    8(fvec3)   Load 45(normal)
                                Store 185(param) 186
             188:    8(fvec3)   Load 46(toEye)
                                Store 187(param) 188
             189:    8(fvec3)   FunctionCall 35(ComputeDirectionalLight(struct-Light-vf3-f1-vf3-f1-vf3-f11;struct-Material-vf4-vf3-f1-mf441;vf3;vf3;) 180(param) 183(param) 185(param) 187(param)
             190:    8(fvec3)   VectorTimesScalar 189 178
             191:    8(fvec3)   Load 164(result)
             192:    8(fvec3)   FAdd 191 190
                                Store 164(result) 192
                                Branch 171
             171:               Label
                                Line 1 141 0
             193:     81(int)   Load 167(i)
             194:     81(int)   IAdd 193 108
                                Store 167(i) 194
                                Branch 168
             170:             Label
                              Line 1 161 0
             195:    8(fvec3) Load 164(result)
             196:    7(float) CompositeExtract 195 0
             197:    7(float) CompositeExtract 195 1
             198:    7(float) CompositeExtract 195 2
             199:   16(fvec4) CompositeConstruct 196 197 198 55
                              ReturnValue 199
                              FunctionEnd
