Fetch.frag
// Module Version 10000
// Generated by (magic number): 80008
// Id's are bound by 93

                              Capability Shader
                              Capability InputAttachment
               2:             ExtInstImport  "GLSL.std.450"
                              MemoryModel Logical GLSL450
                              EntryPoint Fragment 5  "main" 54
                              ExecutionMode 5 OriginUpperLeft
               1:             String  "Fetch.frag"
                              Source GLSL 450 1  "// OpModuleProcessed client vulkan100
// OpModuleProcessed target-env vulkan1.0
// OpModuleProcessed entry-point main
#line 1
#version 450

layout (input_attachment_index = 0, set = 2, binding = 0) uniform subpassInput inputColor;
layout (input_attachment_index = 1, set = 2, binding = 1) uniform subpassInput inputDepth;

layout(set=2, binding=2) uniform PerMaterial{
	float brightness;
	float contrast;
	float depthMin;
	float depthMax;
	int depth;
};

layout(location = 0) out vec4 o_Color;

vec3 brightnessContrast(vec3 color, float brightness, float contrast) {
	return (color - 0.5) * contrast + 0.5 + brightness;
}

void main() {
	if(depth == 0){
		vec3 color = subpassLoad(inputColor).rgb;
		o_Color.rgb = brightnessContrast(color, brightness, contrast);
	}else{
		float depth = subpassLoad(inputDepth).r;
		o_Color.rgb = vec3((depth - depthMin) * 1.0 / (depthMax - depthMin));
	}
}
"
                              Name 5  "main"
                              Name 15  "brightnessContrast(vf3;f1;f1;"
                              Name 12  "color"
                              Name 13  "brightness"
                              Name 14  "contrast"
                              Name 31  "PerMaterial"
                              MemberName 31(PerMaterial) 0  "brightness"
                              MemberName 31(PerMaterial) 1  "contrast"
                              MemberName 31(PerMaterial) 2  "depthMin"
                              MemberName 31(PerMaterial) 3  "depthMax"
                              MemberName 31(PerMaterial) 4  "depth"
                              Name 33  ""
                              Name 43  "color"
                              Name 46  "inputColor"
                              Name 54  "o_Color"
                              Name 56  "param"
                              Name 58  "param"
                              Name 62  "param"
                              Name 69  "depth"
                              Name 70  "inputDepth"
                              MemberDecorate 31(PerMaterial) 0 Offset 0
                              MemberDecorate 31(PerMaterial) 1 Offset 4
                              MemberDecorate 31(PerMaterial) 2 Offset 8
                              MemberDecorate 31(PerMaterial) 3 Offset 12
                              MemberDecorate 31(PerMaterial) 4 Offset 16
                              Decorate 31(PerMaterial) Block
                              Decorate 33 DescriptorSet 2
                              Decorate 33 Binding 2
                              Decorate 46(inputColor) DescriptorSet 2
                              Decorate 46(inputColor) Binding 0
                              Decorate 46(inputColor) InputAttachmentIndex 0
                              Decorate 54(o_Color) Location 0
                              Decorate 70(inputDepth) DescriptorSet 2
                              Decorate 70(inputDepth) Binding 1
                              Decorate 70(inputDepth) InputAttachmentIndex 1
               3:             TypeVoid
               4:             TypeFunction 3
               7:             TypeFloat 32
               8:             TypeVector 7(float) 3
               9:             TypePointer Function 8(fvec3)
              10:             TypePointer Function 7(float)
              11:             TypeFunction 8(fvec3) 9(ptr) 10(ptr) 10(ptr)
              18:    7(float) Constant 1056964608
              30:             TypeInt 32 1
 31(PerMaterial):             TypeStruct 7(float) 7(float) 7(float) 7(float) 30(int)
              32:             TypePointer Uniform 31(PerMaterial)
              33:     32(ptr) Variable Uniform
              34:     30(int) Constant 4
              35:             TypePointer Uniform 30(int)
              38:     30(int) Constant 0
              39:             TypeBool
              44:             TypeImage 7(float) SubpassData nonsampled format:Unknown
              45:             TypePointer UniformConstant 44
  46(inputColor):     45(ptr) Variable UniformConstant
              48:             TypeVector 30(int) 2
              49:   48(ivec2) ConstantComposite 38 38
              50:             TypeVector 7(float) 4
              53:             TypePointer Output 50(fvec4)
     54(o_Color):     53(ptr) Variable Output
              55:     30(int) Constant 1
              59:             TypePointer Uniform 7(float)
  70(inputDepth):     45(ptr) Variable UniformConstant
              73:             TypeInt 32 0
              74:     73(int) Constant 0
              77:     30(int) Constant 2
              81:    7(float) Constant 1065353216
              83:     30(int) Constant 3
         5(main):           3 Function None 4
               6:             Label
       43(color):      9(ptr) Variable Function
       56(param):      9(ptr) Variable Function
       58(param):     10(ptr) Variable Function
       62(param):     10(ptr) Variable Function
       69(depth):     10(ptr) Variable Function
                              Line 1 21 0
              36:     35(ptr) AccessChain 33 34
              37:     30(int) Load 36
              40:    39(bool) IEqual 37 38
                              SelectionMerge 42 None
                              BranchConditional 40 41 68
              41:               Label
                                Line 1 22 0
              47:          44   Load 46(inputColor)
              51:   50(fvec4)   ImageRead 47 49
              52:    8(fvec3)   VectorShuffle 51 51 0 1 2
                                Store 43(color) 52
                                Line 1 23 0
              57:    8(fvec3)   Load 43(color)
                                Store 56(param) 57
              60:     59(ptr)   AccessChain 33 38
              61:    7(float)   Load 60
                                Store 58(param) 61
              63:     59(ptr)   AccessChain 33 55
              64:    7(float)   Load 63
                                Store 62(param) 64
              65:    8(fvec3)   FunctionCall 15(brightnessContrast(vf3;f1;f1;) 56(param) 58(param) 62(param)
              66:   50(fvec4)   Load 54(o_Color)
              67:   50(fvec4)   VectorShuffle 66 65 4 5 6 3
                                Store 54(o_Color) 67
                                Branch 42
              68:               Label
                                Line 1 25 0
              71:          44   Load 70(inputDepth)
              72:   50(fvec4)   ImageRead 71 49
              75:    7(float)   CompositeExtract 72 0
                                Store 69(depth) 75
                                Line 1 26 0
              76:    7(float)   Load 69(depth)
              78:     59(ptr)   AccessChain 33 77
              79:    7(float)   Load 78
              80:    7(float)   FSub 76 79
              82:    7(float)   FMul 80 81
              84:     59(ptr)   AccessChain 33 83
              85:    7(float)   Load 84
              86:     59(ptr)   AccessChain 33 77
              87:    7(float)   Load 86
              88:    7(float)   FSub 85 87
              89:    7(float)   FDiv 82 88
              90:    8(fvec3)   CompositeConstruct 89 89 89
              91:   50(fvec4)   Load 54(o_Color)
              92:   50(fvec4)   VectorShuffle 91 90 4 5 6 3
                                Store 54(o_Color) 92
                                Branch 42
              42:             Label
                              Return
                              FunctionEnd
15(brightnessContrast(vf3;f1;f1;):    8(fvec3) Function None 11
       12(color):      9(ptr) FunctionParameter
  13(brightness):     10(ptr) FunctionParameter
    14(contrast):     10(ptr) FunctionParameter
              16:             Label
                              Line 1 17 0
              17:    8(fvec3) Load 12(color)
              19:    8(fvec3) CompositeConstruct 18 18 18
              20:    8(fvec3) FSub 17 19
              21:    7(float) Load 14(contrast)
              22:    8(fvec3) VectorTimesScalar 20 21
              23:    8(fvec3) CompositeConstruct 18 18 18
              24:    8(fvec3) FAdd 22 23
              25:    7(float) Load 13(brightness)
              26:    8(fvec3) CompositeConstruct 25 25 25
              27:    8(fvec3) FAdd 24 26
                              ReturnValue 27
                              FunctionEnd
